---
title: CoW vs. hardlink
date: 2023-09-20 17:27:13
hero_image: ''
lang: zh
duration: 10min
---

# Copy-on-Write
Copy-on-write 是一种延迟复制的策略，用于减少对于重复数据的冗余复制。
当需要创建一个数据的副本时，Copy-on-write 不会立即复制整个数据，而是共享原始数据的引用。
如果进行副本的任何修改，Copy-on-write 会在修改发生时才复制数据，这样可以节省空间。
Copy-on-write 适用于需要创建大量副本的场景，而且这些副本通常只是进行读取操作。


# hardlink

Hard-link 是一种创建文件或目录的链接的方式，多个链接指向同一个物理存储块。
当创建硬链接时，操作系统会在文件系统中创建一个新的链接（文件名），它引用相同的物理存储块。
不同于副本，硬链接不会复制数据，而是共享相同的数据块。
当任何链接修改共享数据时，这些修改会对所有链接都可见。
删除任何一个链接不会影响其他链接的可用性，只有当所有链接都被删除时，才会释放存储空间。


# 比较
存储空间：Copy-on-write 可以减少存储空间的消耗，因为只有在修改时才进行复制，而硬链接会共享相同的存储空间。
写性能：Copy-on-write 可以提高写入性能，因为不会立即复制整个数据，而硬链接需要同步修改所有链接的共享数据。
数据安全性：Copy-on-write 可以保证数据的一致性，因为每个副本都具有独立的修改空间，而硬链接任何一个链接的修改都会影响其他链接的数据。
链接管理：硬链接可以在文件系统中创建和删除链接，而 Copy-on-write 更多地用于延迟复制数据的策略。
总的来说，Copy-on-write 和 hard-link 是两种不同的技术，适用于不同的场景。Copy-on-write 适用于需要创建大量副本但只进行读取操作的场景，而硬链接适用于在文件系统中创建多个链接指向相同数据的场景。选择使用哪种技术取决于你的具体需求和使用情况。


Copy-on-write的写性能通常会比Hardlink要高，主要有以下几个原因：

复制的数据量：Copy-on-write只有在修改发生时才进行复制，而Hardlink会立即共享相同的数据块。因此，Copy-on-write减少了复制的数据量，减轻了写操作的开销。

内存管理开销：Copy-on-write在创建副本时可以共享原始数据，只有在修改时才需要分配额外的内存空间。而Hardlink需要为每个链接分配独立的内存空间，增加了内存管理的开销。

同步操作：Hardlink需要同步所有链接的数据，以保持一致性。而Copy-on-write只在修改时进行复制，不需要同步其他的副本，避免了不必要的同步开销。

文件系统操作：创建硬链接可能涉及到文件系统的操作，例如修改目录结构，维护链接计数等。这些额外的文件系统操作可能会增加性能开销。
